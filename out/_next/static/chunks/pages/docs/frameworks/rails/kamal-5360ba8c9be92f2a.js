(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6956],{1814:function(s,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/frameworks/rails/kamal",function(){return e(3688)}])},9061:function(s,n,e){"use strict";e.d(n,{N:function(){return o}});var a=e(5893);function o(s){return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("h5",{children:[(0,a.jsx)("a",{href:"/docs#frameworks",children:"Frameworks"})," ",s.framework?(0,a.jsxs)("span",{children:["› ",(0,a.jsx)("a",{href:s.url,children:s.framework})]}):(0,a.jsx)("span",{})]})}),(0,a.jsx)("div",{className:"flex flex-shrink justify-end gap-2",children:s.icon})]})})}},5404:function(s,n,e){"use strict";e.d(n,{X:function(){return o}});var a=e(5893);function o(s){return(0,a.jsx)("p",{className:"lead mt-1",children:s.lead})}},1370:function(s,n,e){"use strict";e.d(n,{c:function(){return l}});var a=e(5893),o=e(5675),r=e.n(o);function l(s){return(0,a.jsx)("div",{className:"w-full p-7 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md",children:(0,a.jsxs)("div",{className:"border border-zinc-300 dark:border-zinc-800 text-zinc-100 text-sm subpixel-antialiased rounded-lg leading-normal overflow-hidden shadow-lg",children:[(0,a.jsx)("div",{className:"p-0 bg-zinc-200 dark:bg-black border-b border-zinc-300 dark:border-zinc-800",children:(0,a.jsxs)("div",{className:"flex py-1 px-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,a.jsx)("span",{className:"h-2 w-2 bg-red-500/70 dark:bg-red-500/30 rounded-full"}),(0,a.jsx)("span",{className:"h-2 w-2 bg-orange-300/70 dark:bg-orange-300/30 rounded-full"}),(0,a.jsx)("span",{className:"h-2 w-2 bg-green-500/70 dark:bg-green-500/30 rounded-full"})]}),(0,a.jsx)("div",{className:"text-right w-full text-zinc-400 text-xs",children:s.www})]})}),(0,a.jsx)("div",{className:"p-0",children:(0,a.jsx)("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"hover:brightness-105",children:(0,a.jsx)(r(),{src:s.url,width:"0",height:"0",alt:"",className:"p-0 m-0 w-full",unoptimized:!0})})})]})})}},2469:function(s,n,e){"use strict";e.d(n,{B:function(){return o}});var a=e(5893);function o(s){return(0,a.jsx)("svg",{fill:"currentColor",viewBox:"0 0 640 640",...s,children:(0,a.jsxs)("g",{transform:"translate(0.000000,640.000000) scale(0.100000,-0.100000)",stroke:"none",children:[(0,a.jsx)("path",{d:"M5717 3893 c-4 -3 -7 -334 -7 -735 l0 -728 220 0 220 0 0 735 0 735 -213 0 c-118 0 -217 -3 -220 -7z"}),(0,a.jsx)("path",{d:"M290 3135 l0 -705 220 0 220 0 0 322 c0 211 3 319 10 312 5 -5 74 -149 153 -319 l143 -310 258 -3 c238 -2 258 -1 252 14 -4 10 -87 169 -186 355 l-180 339 175 332 c95 183 177 341 181 351 6 16 -8 17 -245 15 l-251 -3 -148 -312 c-81 -172 -150 -312 -154 -313 -5 0 -8 142 -8 315 l0 315 -220 0 -220 0 0 -705z"}),(0,a.jsx)("path",{d:"M1967 3504 c-174 -42 -320 -181 -344 -329 l-6 -35 201 0 c162 0 201 3 205 14 8 21 73 39 112 32 52 -10 75 -47 75 -117 0 -33 -1 -59 -2 -59 -2 0 -28 10 -58 22 -47 20 -74 23 -190 23 -116 0 -145 -4 -205 -24 -139 -48 -213 -162 -203 -312 9 -126 78 -223 196 -277 107 -49 308 -41 417 16 27 15 53 28 58 30 4 2 7 -10 7 -27 l0 -31 208 2 207 3 0 355 c0 386 -3 411 -60 512 -53 96 -167 171 -302 202 -87 19 -236 20 -316 0z m197 -675 c36 -17 54 -65 35 -97 -28 -51 -147 -64 -190 -21 -29 29 -25 83 7 108 30 24 106 29 148 10z"}),(0,a.jsx)("path",{d:"M3322 3502 c-29 -11 -70 -33 -92 -51 l-39 -31 -3 38 -3 37 -207 3 -208 2 0 -535 0 -535 215 0 215 0 0 319 c0 328 5 372 40 391 24 13 76 13 100 0 34 -18 40 -75 40 -397 l0 -313 210 0 210 0 0 335 0 336 25 24 c33 34 87 34 120 0 l25 -24 0 -336 0 -335 216 0 215 0 -3 418 -3 417 -26 56 c-36 77 -90 133 -157 166 -138 66 -366 31 -461 -71 l-23 -24 -30 33 c-16 19 -55 46 -86 61 -76 37 -210 44 -290 16z"}),(0,a.jsx)("path",{d:"M4903 3501 c-39 -11 -89 -29 -110 -40 -95 -48 -191 -159 -213 -244 -6 -23 -13 -50 -16 -59 -5 -17 9 -18 194 -18 183 0 200 2 216 19 43 47 143 33 170 -23 14 -31 23 -126 11 -126 -2 0 -28 9 -57 21 -66 26 -215 36 -313 21 -99 -16 -188 -62 -230 -120 -43 -60 -59 -124 -53 -222 6 -96 42 -167 113 -222 126 -95 369 -106 513 -22 l42 25 0 -31 0 -30 211 0 210 0 -3 378 c-3 366 -4 379 -26 432 -52 122 -148 209 -281 251 -96 31 -280 36 -378 10z m223 -684 c76 -65 -21 -160 -129 -125 -72 23 -89 100 -29 132 44 24 126 20 158 -7z"})]})})}},5485:function(s,n,e){"use strict";e.d(n,{u:function(){return o}});var a=e(5893);function o(s){return(0,a.jsx)("svg",{fill:"currentColor",viewBox:"0 0 24 24",...s,children:(0,a.jsx)("path",{d:"M7.523 7.781c-.187 0-.382.011-.582.035l.116.358c.175-.018.351-.024.527-.024h.06l-.12-.369zm2.315.358l-.024.4c.2.067.394.138.588.217l.026-.404c-.055-.03-.208-.104-.59-.213zm-4.988.23a9.597 9.597 0 00-.473.26l.28.426c.157-.097.308-.19.466-.268L4.85 8.37zm2.89.022a5.602 5.602 0 00-.654.027c-.443.04-.909.169-1.38.375-1.418.618-2.878 1.918-3.833 3.51-.955 1.591-1.291 3-1.4 3.603-.037.202-.05.313-.05.313h4.79s-.057-.26-.096-.678a8.18 8.18 0 01-.033-.732c0-.55.055-1.203.244-1.858.047-.163.103-.328.168-.49.065-.162.14-.321.225-.479.17-.314.381-.618.646-.894s.584-.525.963-.736c.248-.12.698-.365 1.346-.489.216-.041.453-.07.713-.076.26-.005.542.012.845.06.606.097 1.298.32 2.075.74.388.211.798.47 1.228.788.11-.09.211-.162.211-.162s-.196-.197-.547-.486c-.35-.29-.853-.672-1.467-1.043-.306-.186-.642-.37-.998-.538a8.852 8.852 0 00-1.129-.44 7.48 7.48 0 00-1.226-.27 6.048 6.048 0 00-.64-.045zm2.086 1.65l-.023.383c.2.006.4.03.6.072l.025-.375a4.32 4.32 0 00-.602-.08zm-1.418.146c-.206.061-.381.127-.533.194l.139.418c.175-.085.351-.157.527-.211l-.133-.4zm-6.008.024c-.157.151-.31.303-.449.455l.467.4c.127-.163.267-.327.412-.478l-.43-.377zm4.34.898c-.14.128-.266.267-.375.407l.291.435c.103-.151.224-.29.358-.43l-.274-.412zm.989.787v4.323h1.164v-1.043L9.9 16.219h1.721l-1.351-1.364s1.06-.09 1.06-1.46c0-1.37-1.285-1.499-1.285-1.499H7.729zm5.292.032c-.842 0-1.126.763-1.126 1.127v3.164h1.181v-.758h1.11v.758h1.146v-3.164c0-.922-.838-1.127-1.129-1.127h-1.182zm2.85 0v4.29h1.23v-4.29h-1.23zm1.733 0v4.291h2.88v-1.11h-1.656v-3.181h-1.224zm4.359 0c-.485 0-1.133.399-1.133 1.144v.383c0 .746.642 1.127 1.133 1.127 1.364.006-.327 0 .933 0v.533l-2.005.006v1.098h1.982c.406 0 1.103-.297 1.127-1.127v-.424c0-.71-.581-1.129-1.127-1.129h-.988v-.508h1.957v-1.103h-1.88zM5.668 12.8a5.75 5.75 0 00-.182.666l.49.388c.025-.236.069-.472.13-.709l-.438-.345zm7.771.15h.407c.327 0 .334.236.334.236v1.05h-1.11v-1.05s0-.236.37-.236zm-4.546.031h.933s.262.097.262.49c0 .395-.268.499-.268.499h-.927v-.989zm-8.59.061c-.115.26-.242.563-.303.727l.697.255c.08-.206.206-.504.303-.728l-.697-.254zm5.092 1.963c.012.321.043.584.074.765l.726.26a8.003 8.003 0 01-.144-.787l-.656-.238z"})})}},3688:function(s,n,e){"use strict";e.r(n),e.d(n,{__N_SSG:function(){return h}});var a=e(5893),o=e(1151),r=e(1490),l=e(1370),t=e(5404),i=e(9061),p=e(2469),c=e(5485);function d(s){let n=Object.assign({h1:"h1",p:"p",h2:"h2",a:"a",pre:"pre",code:"code",strong:"strong"},(0,o.ah)(),s.components),{Note:e}=n;return e||function(s,n){throw Error("Expected "+(n?"component":"object")+" `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}("Note",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.N,{framework:"Rails",url:"/docs/frameworks/rails",icon:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.u,{className:"h-9 w-9 text-[#CC0000]"}),(0,a.jsx)(p.B,{className:"h-9 w-9 text-[#3A80ED]"})]})}),"\n",(0,a.jsx)(n.h1,{children:"Deploy a Rails App with Kamal"}),"\n",(0,a.jsx)(t.X,{lead:"Deploy a Rails app with an encrypted .env.vault file with Kamal."}),"\n",(0,a.jsx)(e,{children:(0,a.jsxs)(n.p,{children:["Find a complete ",(0,a.jsx)("a",{href:"https://github.com/dotenv-org/examples/tree/master/rails/kamal",children:"code example on GitHub"})," for this guide."]})}),"\n",(0,a.jsx)(n.h2,{id:"initial-setup",children:"Initial setup"}),"\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.a,{href:"https://github.com/rails/rails",children:"Rails"}),"."]}),"\n",(0,a.jsx)(n.pre,{code:"gem install rails\n",children:(0,a.jsx)(n.code,{children:"gem install rails\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a new Rails project."}),"\n",(0,a.jsx)(n.pre,{code:"rails new kamal-example\n",children:(0,a.jsx)(n.code,{children:"rails new kamal-example\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Edit ",(0,a.jsx)(n.code,{children:"config/routes.rb"})," and set root to ",(0,a.jsx)(n.code,{children:"www#index"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"ruby",code:'Rails.application.routes.draw do\n  get "up" => "rails/health#show", as: :rails_health_check\n  root "www#index"\nend\n',children:(0,a.jsx)(n.code,{className:"language-ruby",children:'<span><span style="color: var(--shiki-token-constant)">Rails</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">application</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">routes</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">draw </span><span style="color: var(--shiki-token-keyword)">do</span></span>\n<span><span style="color: var(--shiki-color-text)">  get </span><span style="color: var(--shiki-token-string-expression)">&quot;up&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;rails/health#show&quot;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> as: :rails_health_check</span></span>\n<span><span style="color: var(--shiki-color-text)">  root </span><span style="color: var(--shiki-token-string-expression)">&quot;www#index&quot;</span></span>\n<span><span style="color: var(--shiki-token-keyword)">end</span></span>\n<span></span>'}),title:"config/routes.rb"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"app/controllers/www_controller.rb"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"ruby",code:"class WwwController < ApplicationController\n  def index\n  end\nend\n",children:(0,a.jsx)(n.code,{className:"language-ruby",children:'<span><span style="color: var(--shiki-token-keyword)">class</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">WwwController</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">ApplicationController</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">def</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">index</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">end</span></span>\n<span><span style="color: var(--shiki-token-keyword)">end</span></span>\n<span></span>'}),title:"app/controllers/www_controller.rb"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"app/views/www/index.html.erb"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"erb",code:'Hello <%= ENV["HELLO"] %>.\n',children:(0,a.jsx)(n.code,{className:"language-erb",children:'<span><span style="color: var(--shiki-color-text)">Hello &lt;%= </span><span style="color: var(--shiki-token-constant)">ENV</span><span style="color: var(--shiki-color-text)">[</span><span style="color: var(--shiki-token-string-expression)">&quot;HELLO&quot;</span><span style="color: var(--shiki-color-text)">] %&gt;.</span></span>\n<span></span>'}),title:"app/views/www/index.html.erb"}),"\n",(0,a.jsxs)(n.p,{children:["Commit those changes safely to code. Next, we'll set up ",(0,a.jsx)(n.a,{href:"https://kamal-deploy.org",children:"Kamal"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"set-up-kamal",children:"Set up Kamal"}),"\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.a,{href:"https://kamal-deploy.org",children:"Kamal"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"gem install kamal\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">gem install kamal</span></span>\n<span></span>'})}),"\n",(0,a.jsx)(n.p,{children:"Initialize Kamal."}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"kamal init\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">kamal init</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["Edit your ",(0,a.jsx)(n.code,{children:"config/deploy.yml"})," file."]}),"\n",(0,a.jsx)(n.pre,{language:"yaml",code:'# Name of your application. Used to uniquely configure containers.\nservice: kamal-example\n\n# Name of the container image.\nimage: yourdockerorg/kamal-example\n\n# Deploy to these servers. Replace with your server(s) ip address(es)\nservers:\n  - 5.78.32.32 # your_server_ip\n\n# Credentials for your image host.\nregistry:\n  # Specify the registry server, if you\'re not using Docker Hub\n  # server: registry.digitalocean.com / ghcr.io / ...\n  username: your_username_on_docker_hub\n\n  # Always use an access token rather than real password when possible.\n  password:\n    - KAMAL_REGISTRY_PASSWORD\n\n# Inject ENV variables into containers (secrets come from .env).\n# Remember to run `kamal env push` after making changes!\n# env:\n#   clear:\n#     DB_HOST: 192.168.0.2\n#   secret:\n#     - RAILS_MASTER_KEY\nenv:\n  secret:\n    - RAILS_MASTER_KEY\n\n# https://dev.to/adrienpoly/deploying-a-rails-app-with-mrsk-on-hetzner-a-beginners-guide-39kp\nvolumes:\n  - "storage:/rails/storage"\n',children:(0,a.jsx)(n.code,{className:"language-yaml",children:'<span><span style="color: var(--shiki-token-comment)"># Name of your application. Used to uniquely configure containers.</span></span>\n<span><span style="color: var(--shiki-token-keyword)">service</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">kamal-example</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># Name of the container image.</span></span>\n<span><span style="color: var(--shiki-token-keyword)">image</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">yourdockerorg/kamal-example</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># Deploy to these servers. Replace with your server(s) ip address(es)</span></span>\n<span><span style="color: var(--shiki-token-keyword)">servers</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">  - </span><span style="color: var(--shiki-token-constant)">5.78.32.32</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)"># your_server_ip</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># Credentials for your image host.</span></span>\n<span><span style="color: var(--shiki-token-keyword)">registry</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># Specify the registry server, if you&#39;re not using Docker Hub</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># server: registry.digitalocean.com / ghcr.io / ...</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">username</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">your_username_on_docker_hub</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># Always use an access token rather than real password when possible.</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">password</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">    - </span><span style="color: var(--shiki-token-string-expression)">KAMAL_REGISTRY_PASSWORD</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># Inject ENV variables into containers (secrets come from .env).</span></span>\n<span><span style="color: var(--shiki-token-comment)"># Remember to run `kamal env push` after making changes!</span></span>\n<span><span style="color: var(--shiki-token-comment)"># env:</span></span>\n<span><span style="color: var(--shiki-token-comment)">#   clear:</span></span>\n<span><span style="color: var(--shiki-token-comment)">#     DB_HOST: 192.168.0.2</span></span>\n<span><span style="color: var(--shiki-token-comment)">#   secret:</span></span>\n<span><span style="color: var(--shiki-token-comment)">#     - RAILS_MASTER_KEY</span></span>\n<span><span style="color: var(--shiki-token-keyword)">env</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">secret</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">    - </span><span style="color: var(--shiki-token-string-expression)">RAILS_MASTER_KEY</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># https://dev.to/adrienpoly/deploying-a-rails-app-with-mrsk-on-hetzner-a-beginners-guide-39kp</span></span>\n<span><span style="color: var(--shiki-token-keyword)">volumes</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">  - </span><span style="color: var(--shiki-token-string-expression)">&quot;storage:/rails/storage&quot;</span></span>\n<span></span>'}),title:"config/deploy.yml"}),"\n",(0,a.jsx)(n.p,{children:"Make sure you can ssh to your server."}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"ssh root@your_server_ip\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">ssh root@your_server_ip</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["Then modify your ",(0,a.jsx)(n.code,{children:".env"})," file, setting your ",(0,a.jsx)(n.code,{children:"KAMAL_REGISTRY_PASSWORD"})," to your docker registry's password and your ",(0,a.jsx)(n.code,{children:"RAILS_MASTER_KEY"}),". Find your RAILS_MASTER_KEY at ",(0,a.jsx)(n.code,{children:"config/master.key"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"KAMAL_REGISTRY_PASSWORD=your-docker-registry-password\nRAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">KAMAL_REGISTRY_PASSWORD=your-docker-registry-password</span></span>\n<span><span style="color: var(--shiki-color-text)">RAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b</span></span>\n<span></span>'}),title:".env"}),"\n",(0,a.jsxs)(n.p,{children:["Turn off ",(0,a.jsx)(n.code,{children:"force_ssl"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"ruby",code:"Rails.application.configure do\n  ...\n  # Assume all access to the app is happening through a SSL-terminating reverse proxy.\n  # Can be used together with config.force_ssl for Strict-Transport-Security and secure cookies.\n  # config.assume_ssl = true\n\n  # Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.\n  config.force_ssl = false\n  ...\nend\n",children:(0,a.jsx)(n.code,{className:"language-ruby",children:'<span><span style="color: var(--shiki-token-constant)">Rails</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">application</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">configure </span><span style="color: var(--shiki-token-keyword)">do</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-punctuation)">...</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># Assume all access to the app is happening through a SSL-terminating reverse proxy.</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># Can be used together with config.force_ssl for Strict-Transport-Security and secure cookies.</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># config.assume_ssl = true</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-comment)"># Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.</span></span>\n<span><span style="color: var(--shiki-color-text)">  config</span><span style="color: var(--shiki-token-punctuation)">.</span><span style="color: var(--shiki-color-text)">force_ssl </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">false</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-punctuation)">...</span></span>\n<span><span style="color: var(--shiki-token-keyword)">end</span></span>\n<span></span>'}),title:"config/environments/production.rb"}),"\n",(0,a.jsxs)(n.p,{children:["Then run ",(0,a.jsx)(n.code,{children:"kamal setup"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"kamal setup\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">kamal setup</span></span>\n<span></span>'})}),"\n",(0,a.jsx)(n.p,{children:"This will bootstrap your server with everything it needs - docker and your Rails application."}),"\n",(0,a.jsx)(n.p,{children:"Visit your server's ip address."}),"\n",(0,a.jsx)(l.c,{url:"/assets/img/docs/hello-blank.png",www:"your_server_ip"}),"\n",(0,a.jsxs)(n.p,{children:["Your app will say ",(0,a.jsx)(n.code,{children:"'Hello .'"})," at ",(0,a.jsx)(n.strong,{children:"your_server_ip"})," as it doesn't have a way to access the environment variable yet. Let’s do that next."]}),"\n",(0,a.jsx)(n.h2,{id:"install-dotenv-vault-rails",children:"Install dotenv-vault-rails"}),"\n",(0,a.jsxs)(n.p,{children:["Add ",(0,a.jsx)(n.a,{href:"https://github.com/dotenv-org/dotenv-vault-ruby",children:(0,a.jsx)(n.code,{children:"dotenv-vault-rails"})})," to the top of your Gemfile."]}),"\n",(0,a.jsx)(n.pre,{language:"ruby",code:'source "https://rubygems.org"\nruby "3.1.3"\ngem "dotenv-vault-rails", require: "dotenv-vault/rails-now"\ngem "rails", "~> 7.1.1"\n...\n',children:(0,a.jsx)(n.code,{className:"language-ruby",children:'<span><span style="color: var(--shiki-color-text)">source </span><span style="color: var(--shiki-token-string-expression)">&quot;https://rubygems.org&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">ruby </span><span style="color: var(--shiki-token-string-expression)">&quot;3.1.3&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">gem </span><span style="color: var(--shiki-token-string-expression)">&quot;dotenv-vault-rails&quot;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> require: </span><span style="color: var(--shiki-token-string-expression)">&quot;dotenv-vault/rails-now&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">gem </span><span style="color: var(--shiki-token-string-expression)">&quot;rails&quot;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;~&gt; 7.1.1&quot;</span></span>\n<span><span style="color: var(--shiki-token-punctuation)">...</span></span>\n<span></span>'}),title:"Gemfile"}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"bundle install\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">bundle install</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["Add ",(0,a.jsx)(n.code,{children:"HELLO=World"})," to your ",(0,a.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"KAMAL_REGISTRY_PASSWORD=your-docker-registry-password\nRAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b\nHELLO=World\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">KAMAL_REGISTRY_PASSWORD=your-docker-registry-password</span></span>\n<span><span style="color: var(--shiki-color-text)">RAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b</span></span>\n<span><span style="color: var(--shiki-color-text)">HELLO=World</span></span>\n<span></span>'}),title:".env"}),"\n",(0,a.jsx)(n.p,{children:"Try running it locally."}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"bin/rails server\n=> Booting Puma\n=> Rails 7.1.1 application starting in development\n* Listening on http://127.0.0.1:3000\n* Listening on http://[::1]:3000\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">bin/rails server</span></span>\n<span><span style="color: var(--shiki-color-text)">=</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> Booting Puma</span></span>\n<span><span style="color: var(--shiki-color-text)">=</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> Rails 7.1.1 application starting </span><span style="color: var(--shiki-token-keyword)">in</span><span style="color: var(--shiki-color-text)"> development</span></span>\n<span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> Listening on http://127.0.0.1:3000</span></span>\n<span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> Listening on http://[::1]:3000</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["It should say ",(0,a.jsx)(n.code,{children:"Hello World"}),"."]}),"\n",(0,a.jsx)(l.c,{url:"/assets/img/docs/nextjs-hello-world.png",www:"localhost:3000"}),"\n",(0,a.jsxs)(n.p,{children:["Great! ",(0,a.jsx)(n.code,{children:"ENV"})," now has the keys and values you defined in your ",(0,a.jsx)(n.code,{children:".env"})," file. That covers local development. Let's solve for production next."]}),"\n",(0,a.jsx)(n.h2,{id:"build-env-vault",children:"Build .env.vault"}),"\n",(0,a.jsxs)(n.p,{children:["Push your latest ",(0,a.jsx)(n.code,{children:".env"})," file changes and edit your production secrets. ",(0,a.jsx)(n.a,{href:"/docs/tutorials/sync",children:"Learn more about syncing"})]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"npx dotenv-vault@latest push\nnpx dotenv-vault@latest open production\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">npx dotenv-vault@latest push</span></span>\n<span><span style="color: var(--shiki-color-text)">npx dotenv-vault@latest open production</span></span>\n<span></span>'})}),"\n",(0,a.jsx)(n.p,{children:"Use the UI to configure those secrets per environment."}),"\n",(0,a.jsx)(l.c,{url:"/assets/img/docs/edit-production-value.gif",www:"www.dotenv.org"}),"\n",(0,a.jsxs)(n.p,{children:["Then build your encrypted ",(0,a.jsx)(n.code,{children:".env.vault"})," file."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"npx dotenv-vault@latest build\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">npx dotenv-vault@latest build</span></span>\n<span></span>'})}),"\n",(0,a.jsx)(n.p,{children:"Its contents should look something like this."}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:'#/-------------------.env.vault---------------------/\n#/         cloud-agnostic vaulting standard         /\n#/   [how it works](https://dotenv.org/env-vault)   /\n#/--------------------------------------------------/\n\n# development\nDOTENV_VAULT_DEVELOPMENT="/HqNgQWsf6Oh6XB9pI/CGkdgCe6d4/vWZHgP50RRoDTzkzPQk/xOaQs="\nDOTENV_VAULT_DEVELOPMENT_VERSION=2\n\n# production\nDOTENV_VAULT_PRODUCTION="x26PuIKQ/xZ5eKrYomKngM+dO/9v1vxhwslE/zjHdg3l+H6q6PheB5GVDVIbZg=="\nDOTENV_VAULT_PRODUCTION_VERSION=2\n',children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-token-comment)">#/-------------------.env.vault---------------------/</span></span>\n<span><span style="color: var(--shiki-token-comment)">#/         cloud-agnostic vaulting standard         /</span></span>\n<span><span style="color: var(--shiki-token-comment)">#/   [how it works](https://dotenv.org/env-vault)   /</span></span>\n<span><span style="color: var(--shiki-token-comment)">#/--------------------------------------------------/</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># development</span></span>\n<span><span style="color: var(--shiki-color-text)">DOTENV_VAULT_DEVELOPMENT=</span><span style="color: var(--shiki-token-string-expression)">&quot;/HqNgQWsf6Oh6XB9pI/CGkdgCe6d4/vWZHgP50RRoDTzkzPQk/xOaQs=&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">DOTENV_VAULT_DEVELOPMENT_VERSION=2</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-comment)"># production</span></span>\n<span><span style="color: var(--shiki-color-text)">DOTENV_VAULT_PRODUCTION=</span><span style="color: var(--shiki-token-string-expression)">&quot;x26PuIKQ/xZ5eKrYomKngM+dO/9v1vxhwslE/zjHdg3l+H6q6PheB5GVDVIbZg==&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">DOTENV_VAULT_PRODUCTION_VERSION=2</span></span>\n<span></span>'}),title:".env.vault"}),"\n",(0,a.jsx)(n.h2,{id:"set-dotenv-key",children:"Set DOTENV_KEY"}),"\n",(0,a.jsxs)(n.p,{children:["Fetch your production ",(0,a.jsx)(n.code,{children:"DOTENV_KEY"}),"."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"npx dotenv-vault@latest keys production\n# outputs: dotenv://:key_1234@dotenv.org/vault/.env.vault?environment=production\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">npx dotenv-vault@latest keys production</span></span>\n<span><span style="color: var(--shiki-token-comment)"># outputs: dotenv://:key_1234@dotenv.org/vault/.env.vault?environment=production</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["Set ",(0,a.jsx)(n.code,{children:"DOTENV_KEY"})," for Kamal's ",(0,a.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:'KAMAL_REGISTRY_PASSWORD=your-docker-registry-password\nRAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b\nHELLO=World\nDOTENV_KEY="dotenv://:key_1234@dotenv.org/vault/.env.vault?environment=production"\n',children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">KAMAL_REGISTRY_PASSWORD=your-docker-registry-password</span></span>\n<span><span style="color: var(--shiki-color-text)">RAILS_MASTER_KEY=11011070047a1cf7bacd3f7fd6bacd9b</span></span>\n<span><span style="color: var(--shiki-color-text)">HELLO=World</span></span>\n<span><span style="color: var(--shiki-color-text)">DOTENV_KEY=</span><span style="color: var(--shiki-token-string-expression)">&quot;dotenv://:key_1234@dotenv.org/vault/.env.vault?environment=production&quot;</span></span>\n<span></span>'}),title:".env"}),"\n",(0,a.jsxs)(n.p,{children:["And ",(0,a.jsx)(n.code,{children:"DOTENV_KEY"})," to Kamal's ",(0,a.jsx)(n.code,{children:"config/deploy.yml"})," ",(0,a.jsx)(n.code,{children:"env.secret"})," section."]}),"\n",(0,a.jsx)(n.pre,{language:"yaml",code:"...\nenv:\n  secret:\n    - RAILS_MASTER_KEY\n    - DOTENV_KEY\n...\n",children:(0,a.jsx)(n.code,{className:"language-yaml",children:'<span><span style="color: var(--shiki-color-text)">...</span></span>\n<span><span style="color: var(--shiki-token-keyword)">env</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">secret</span><span style="color: var(--shiki-token-keyword)">:</span></span>\n<span><span style="color: var(--shiki-color-text)">    - </span><span style="color: var(--shiki-token-string-expression)">RAILS_MASTER_KEY</span></span>\n<span><span style="color: var(--shiki-color-text)">    - </span><span style="color: var(--shiki-token-string-expression)">DOTENV_KEY</span></span>\n<span><span style="color: var(--shiki-color-text)">...</span></span>\n<span></span>'}),title:"config/deploy.yml"}),"\n",(0,a.jsxs)(n.p,{children:["Push those ",(0,a.jsx)(n.code,{children:"ENV"})," changes to Kamal."]}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"kamal env push\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">kamal env push</span></span>\n<span></span>'})}),"\n",(0,a.jsx)(n.h2,{id:"deploy-kamal",children:"Deploy Kamal"}),"\n",(0,a.jsx)(n.p,{children:"Commit those changes safely to code and deploy with Kamal."}),"\n",(0,a.jsx)(n.pre,{language:"shell",code:"kamal deploy\n",children:(0,a.jsx)(n.code,{className:"language-shell",children:'<span><span style="color: var(--shiki-color-text)">kamal deploy</span></span>\n<span></span>'})}),"\n",(0,a.jsxs)(n.p,{children:["That's it! On build and deploy, your ",(0,a.jsx)(n.code,{children:".env.vault"})," file will be decrypted and its production secrets injected as environment variables – just in time."]}),"\n",(0,a.jsx)(l.c,{url:"/assets/img/docs/hello-production.png",www:"your_server_ip"}),"\n",(0,a.jsx)(r.default,{})]})}var h=!0;n.default=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),s.components);return n?(0,a.jsx)(n,Object.assign({},s,{children:(0,a.jsx)(d,s)})):d(s)}},1490:function(s,n,e){"use strict";e.r(n),e.d(n,{__N_SSG:function(){return l}});var a=e(5893),o=e(1151);function r(s){let n=Object.assign({p:"p"},(0,o.ah)(),s.components),{Note:e}=n;return e||function(s,n){throw Error("Expected "+(n?"component":"object")+" `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}("Note",!0),(0,a.jsx)(e,{children:(0,a.jsx)(n.p,{children:"You succesfully used the new .env.vault standard to encrypt and deploy your secrets. This is much safer than scattering your secrets across multiple third-party platforms and tools. Whenever you need to add or change a secret, just rebuild your .env.vault file and redeploy."})})}var l=!0;n.default=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),s.components);return n?(0,a.jsx)(n,Object.assign({},s,{children:(0,a.jsx)(r,s)})):r(s)}}},function(s){s.O(0,[5675,9774,2888,179],function(){return s(s.s=1814)}),_N_E=s.O()}]);